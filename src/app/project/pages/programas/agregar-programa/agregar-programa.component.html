<app-breadcrumbgp></app-breadcrumbgp>
<p-toast [key]="programasService.keyPopups"></p-toast>

<app-dialog [(visible)]="showDialogDocs">
    <div header>
        <span class="text-xl">Adjuntar documentos</span>
    </div>
    <div content>
        <app-uploader-files></app-uploader-files>
    </div>
    <div footer>
        <p-button label="Cerrar" icon="pi pi-times" styleClass="p-button-sm p-button-secondary mr-2" (click)="showDialogDocs = false" [text]="true"></p-button>
    </div>
</app-dialog>

<app-dialog [dialogWidth]="'75vw'" [(visible)]="showDialogEstadoAcreditacion">
    <div header>
        <span class="text-xl">Agregar estado de acreditación</span>
    </div>
    <div content>
        <app-form-estados-acreditacion *ngIf="showDialogEstadoAcreditacion"></app-form-estados-acreditacion>
    </div>
    <div footer>
        <p-button label="Cerrar" icon="pi pi-times" styleClass="p-button-sm p-button-secondary mr-2"
            (click)="showDialogEstadoAcreditacion = false" [text]="true"></p-button>

        <p-button 
            label="Guardar"
            icon="pi pi-check"
            styleClass="mr-2 p-button-success p-button-sm" 
            [disabled]="estadosAcreditacionService.stateForm === 'INVALID' ||  estadosAcreditacionService.stateForm === undefined "
            (click)="submitNewEstadoAcreditacion()">
        </p-button>
    </div>
</app-dialog>

<app-dialog [dialogWidth]="'75vw'" [(visible)]="newReglamentoDialog">
    <div header>
        <span class="text-xl">Agregar reglamento</span>
    </div>
    <div content>
        <app-form-reglamentos *ngIf="newReglamentoDialog"></app-form-reglamentos>
    </div>
    <div footer>
        <p-button label="Cerrar" icon="pi pi-times" styleClass="p-button-sm p-button-secondary mr-2"
            (click)="newReglamentoDialog = false" [text]="true"></p-button>

        <p-button 
            label="Guardar"
            icon="pi pi-check"
            styleClass="mr-2 p-button-success p-button-sm" 
            [disabled]="reglamentosService.stateForm === 'INVALID' || reglamentosService.stateForm === undefined "
            (click)="submitNewReglamento()">
        </p-button>
    </div>
</app-dialog>

<p-card >
    <ng-template pTemplate="header" >
        <div class="flex justify-content-between flex-wrap"  [style]="{ 'padding-left': '1.5rem' , 'padding-top': '1.5rem' , 'padding-right': '1.5rem'}">
            <div>
                <div class="p-card-title">Agregar programa</div>
                <div class="p-card-subtitle">Permite agregar un programa.</div>

            </div>
            <div>
                <!-- <p-button 
                    label="test" 
                    icon="pi pi-times" 
                    styleClass="p-button-sm p-button-secondary mr-2" 
                    (click)="test()" [text]="true"></p-button> -->
                <button pButton icon="pi pi-upload" label="Adjuntar documento maestro" (click)="chooseDocs('Maestro')"></button>
                <button 
                    pButton 
                    class="{{ programasService.stateFormPrograma ? 'p-button-success' : 'p-button-danger' }} p-button-outlined ml-2" 
                    icon="pi {{ programasService.stateFormPrograma ? 'pi-check' : 'pi-times' }}" 
                    label="Estado formulario"
                    iconPos="right"
                    (click)="changeDisposition()" 
                >
                </button>
            </div>
        </div>
    </ng-template>

    <ng-template pTemplate="body">
        <div class="layout-container" [ngClass]="containerClass">
            
            <div class="layout-content-wrapper">
                <form [formGroup]="programasService.fbForm">
                    <p-stepper (activeStepChange)="stepChange($event)">
                        <p-stepperPanel id="paso1">
                            <ng-template pTemplate="content" let-nextCallback="nextCallback" let-index="index">
                                <app-form-programas-step-one></app-form-programas-step-one>
                                <div class="flex pt-4 justify-content-end">
                                    <p-button label="Siguiente" icon="pi pi-arrow-right" iconPos="right" (onClick)="nextCallback.emit()" />
                                </div>
                            </ng-template>
                        </p-stepperPanel>
                        <p-stepperPanel id="paso2">
                            <ng-template pTemplate="content" let-prevCallback="prevCallback" let-nextCallback="nextCallback" let-index="index">
                                <app-form-programas-step-two></app-form-programas-step-two>
                                <div class="flex pt-4 justify-content-between">
                                    <p-button label="Atrás" icon="pi pi-arrow-left" (onClick)="prevCallback.emit()" />
                                    <p-button label="Siguiente" icon="pi pi-arrow-right" iconPos="right" (onClick)="nextCallback.emit()" />
                                </div>
                            </ng-template>
                        </p-stepperPanel>
                        <p-stepperPanel id="paso3">
                            <ng-template pTemplate="content" let-prevCallback="prevCallback" let-nextCallback="nextCallback">
                                <div class="flex flex-column">
                                    <p-accordion class="w-full" [activeIndex]="0" (onOpen)="openAccordion()">

                                        <p-accordionTab id="reglamento">
                                            <ng-template pTemplate="header">
                                                <div class="flex justify-content-between flex-wrap w-full">
                                                    <div>
                                                        <span><strong>Reglamento</strong></span>
                                                    </div>
                                                    <div *ngIf="programasService.reglamentoSelected !== '' ">
                                                        <span style="font-weight: 100;"><i>{{ programasService.reglamentoSelected }}</i></span>
                                                    </div>
                                                </div>
                                            </ng-template>
                                            <ng-template pTemplate="body">
                                                <div class="grid flex justify-content-center align-items-center h-full">
                                                    <div class="col-12 lg:col-10">
                                                        <p-messages severity="info">
                                                            <ng-template pTemplate>
                                                                <i class="pi pi-info-circle mr-3"></i>
                                                                <span>
                                                                    Seleccione un reglamento registrado en la tabla. Si no está registrado, agregue uno presionando el botón <strong>Agregar</strong>.
                                                                </span>
                                                            </ng-template>
                                                        </p-messages>
                                                    </div>
                                                    <div class="col-12 lg:col-2">
                                                        <div class="flex justify-content-center align-items-center h-full">
                                                            <p-button
                                                                label="Agregar"
                                                                icon="pi pi-plus"
                                                                styleClass="p-button-success p-button-sm"
                                                                (click)="addNewReglamento()"
                                                            ></p-button>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <app-table-programas-reglamentos [data]="reglamentos"></app-table-programas-reglamentos>
                                            </ng-template>
                                        </p-accordionTab>

                                        <p-accordionTab id="director">
                                            <ng-template pTemplate="header">
                                                <div class="flex justify-content-between flex-wrap w-full">
                                                    <div>
                                                        <span><strong>Director</strong></span>
                                                    </div>
                                                    <div *ngIf="programasService.directorSelected.nombre !== '' ">
                                                        <span style="font-weight: 100;"><i>{{ programasService.directorSelected.rut }} - {{ programasService.directorSelected.nombre }} </i></span>
                                                    </div>
                                                </div>
                                            </ng-template>
                                            <ng-template pTemplate="body">
                                                <div class="formgrid grid">
                                                    <div class="field col-12">
                                                        <p-messages severity="info">
                                                            <ng-template pTemplate>
                                                                <i class="pi pi-info-circle mr-3"></i>
                                                                <span>Ingrese RUT del director, luego presione el botón buscar y seleccione en la tabla.</span>
                                                            </ng-template>
                                                        </p-messages>
                                                    </div>
                                                    <div class="field col-12 lg:col-4">
                                                        <label><strong>RUT director *</strong></label>
                                                        <p-inputGroup>
                                                            <input type="text" pInputText formControlName="Director" placeholder="Ingrese RUT del director" />
                                                            <button type="button" pButton icon="pi pi-search" [disabled]="programasService.fbForm.controls['Director'].invalid" (click)="searchDirector('director')"></button>
                                                        </p-inputGroup>
                                                        <small>Sin puntos y con guión. Ejemplo: 11111111-0</small>
                                                        <app-form-control [control]="programasService.fbForm.controls['Director']" [validators]="['required', 'rut']"></app-form-control>
                                                    </div>
                                                    <div class="col-12 lg:col-8">
                                                        <div class="field">
                                                            <label><strong>Director encontrado</strong></label>
                                                            <app-table-programas-directores mode="director" [data]="directores"></app-table-programas-directores>
                                                        </div>
                                                    </div>
                                                </div>
                                            </ng-template>
                                        </p-accordionTab>

                                        <p-accordionTab id="directoralterno">
                                            <ng-template pTemplate="header">
                                                <div class="flex justify-content-between flex-wrap w-full">
                                                    <div>
                                                        <span><strong>Director alterno</strong></span>
                                                    </div>
                                                    <div *ngIf="programasService.directorAlternoSelected.nombre !== '' ">
                                                        <span style="font-weight: 100;"><i>{{ programasService.directorAlternoSelected.rut }} - {{ programasService.directorAlternoSelected.nombre }} </i></span>
                                                    </div>
                                                </div>
                                            </ng-template>
                                            <ng-template pTemplate="body">
                                                <div class="formgrid grid">
                                                    <div class="field col-12">
                                                        <p-messages severity="info">
                                                            <ng-template pTemplate>
                                                                <i class="pi pi-info-circle mr-3"></i>
                                                                <span>Ingrese RUT del director alterno, luego presione el botón buscar y seleccione en la tabla.</span>
                                                            </ng-template>
                                                        </p-messages>
                                                    </div>
                                                    <div class="field col-12 lg:col-4">
                                                        <label><strong>RUT director alterno *</strong></label>
                                                        <p-inputGroup>
                                                            <input type="text" pInputText formControlName="Director_alterno" placeholder="Ingrese RUT del director alterno" />
                                                            <button type="button" pButton icon="pi pi-search" [disabled]="programasService.fbForm.controls['Director_alterno'].invalid" (click)="searchDirector('directoralterno')"></button>
                                                        </p-inputGroup>
                                                        <small>Sin puntos y con guión. Ejemplo: 11111111-0</small>
                                                        <app-form-control [control]="programasService.fbForm.controls['Director_alterno']" [validators]="['required', 'rut']"></app-form-control>
                                                    </div>
                                                    <div class="col-12 lg:col-8">
                                                        <div class="field">
                                                            <label><strong>Director alterno encontrado</strong></label>
                                                            <app-table-programas-directores mode="alterno" [data]="directoresAlternos"></app-table-programas-directores>
                                                        </div>
                                                    </div>
                                                </div>
                                            </ng-template>
                                        </p-accordionTab>

                                        <p-accordionTab id="estadoacreditacion">
                                            <ng-template pTemplate="header">
                                                <div class="flex justify-content-between flex-wrap w-full">
                                                    <div>
                                                        <span><strong>Estado acreditación</strong></span>
                                                    </div>
                                                    <div *ngIf="programasService.estadoAcreditacionSelected !== '' ">
                                                        <span style="font-weight: 100;"><i>{{ programasService.estadoAcreditacionSelected }}</i></span>
                                                    </div>
                                                </div>
                                            </ng-template>
                                            <ng-template pTemplate="body">
                                                <div class="grid flex justify-content-center align-items-center h-full">
                                                    <div class="col-12 lg:col-10">
                                                        <p-messages severity="info">
                                                            <ng-template pTemplate>
                                                                <i class="pi pi-info-circle mr-3"></i>
                                                                <span>
                                                                    Seleccione un estado de acreditación registrado en la tabla. Si no está registrado, agregue uno presionando el botón <strong>Agregar</strong>.
                                                                </span>
                                                            </ng-template>
                                                        </p-messages>
                                                    </div>
                                                    <div class="col-12 lg:col-2">
                                                        <div class="flex justify-content-center align-items-center h-full">
                                                            <p-button
                                                                label="Agregar"
                                                                icon="pi pi-plus"
                                                                styleClass="p-button-success p-button-sm"
                                                                (click)="addNewEstadoAcreditacion()"
                                                            ></p-button>
                                                        </div>
                                                    </div>
                                                </div>
                                                <app-table-programas-estados-acreditacion [data]="estadosAcreditacion" ></app-table-programas-estados-acreditacion>
                                            </ng-template>
                                        </p-accordionTab>

                                    </p-accordion>
                                </div>
                                <div class="flex pt-4 justify-content-between">
                                    <p-button label="Atrás" icon="pi pi-arrow-left" (onClick)="prevCallback.emit()" />
                                    <p-button label="Agregar" icon="pi pi-check" iconPos="right" (onClick)="submit()" [disabled]="!programasService.stateFormPrograma" />
                                </div>
                            </ng-template>
                        </p-stepperPanel>
                    </p-stepper>
                </form>
            </div>
            <div class="layout-sidebar" *ngIf="programasService.disposition">
                <p-card  styleClass="border-1 surface-border border-round rounded-lg">
                    <ng-template pTemplate="header">
                        <div class="flex flex-row flex-wrap"  [style]="{ 'padding-left': '1.5rem' , 'padding-top': '1.5rem' , 'padding-right': '1.5rem'}">
                            <div class="align-items-center">
                                <div class="p-card-title">Estado formulario</div>
                            </div>
                            <div class="align-items-center ml-2" [style]="{'margin-top': '0.1rem !important'}">
                                <i class="pi pi-question-circle" [pTooltip]='tooltipContent' tooltipPosition="top"></i>
                                <ng-template #tooltipContent>
                                    <small>Indica el estado de validación de cada campo del formulario. Para cerrar, presione el botón "Estado formulario".</small>
                                </ng-template>
                            </div>
                        </div>
                    </ng-template>
                    <app-state-form></app-state-form>
                </p-card>
            </div>
            

        </div>

    </ng-template>

</p-card>